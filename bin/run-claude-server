#!/usr/bin/env python

import logging
from argparse import ArgumentParser
from gevent import pywsgi
from geventwebsocket.handler import WebSocketHandler
from claude.app import app, config

logger = logging.getLogger('claude')

parser = ArgumentParser()
parser.add_argument('-d', '--debug', action = 'store_true', default = False)
args = parser.parse_args()

if args.debug:
    app.debug = True

server = pywsgi.WSGIServer((config.host, config.port), app, handler_class = WebSocketHandler)

try:
    logger.info("Listening on http://%s:%s", config.host, config.port)
    server.serve_forever()
except KeyboardInterrupt:
    logger.info("Close")
    server.stop()

